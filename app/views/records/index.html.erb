<h1>Progress</h1>

<span>Project plan</span>
<span><%= @project.start_date %> - <%= @project.planned_end_date %></span>

<table class="records">
  <thead>
    <tr>
      <%# First column %>
      <th>Building Unit</th>

      <%# Rest of columns (dates) %>
      <% date = @project.start_date %>
      <% while date <= @project.planned_end_date do %>
        <%= render partial: "date_header", locals: { date: date } %>
        <% date = date.next_day %>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @building_units.each do |bu| %>
      <tr>
        <%# First column %>
        <td><%= bu.name %></td>

        <%# Rest of columns (dates) %>
        <% date = @project.start_date %>
        <% while date <= @project.planned_end_date do %>
          <% records_for_bu = @records_map[bu.id] %>
          <% records_for_date = records_for_bu.filter { |rec| rec.start_date == date }%>
          <% record = records_for_date[0] %>

          <%= render partial: "date", locals: {
            project: @project,
            bu: bu,
            record: record,
            date: date
          } %>

          <% date = date.next_day %>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>